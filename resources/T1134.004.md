# T1134.004: Parent PID Spoofing
**MITRE ATT&CK Tactic(s):** Defense Evasion, Privilege Escalation

**[MITRE ATT&CK Description](https://attack.mitre.org/techniques/T1134/004)**
<blockquote>Adversaries may spoof the parent process identifier (PPID) of a new process to evade process-monitoring defenses or to elevate privileges. New processes are typically spawned directly from their parent, or calling, process unless explicitly specified. One way of explicitly assigning the PPID of a new process is via the <code>CreateProcess</code> API call, which supports a parameter that defines the PPID to use.(Citation: DidierStevens SelectMyParent Nov 2009) This functionality is used by Windows features such as User Account Control (UAC) to correctly set the PPID after a requested elevated process is spawned by SYSTEM (typically via <code>svchost.exe</code> or <code>consent.exe</code>) rather than the current user context.(Citation: Microsoft UAC Nov 2018)

Adversaries may abuse these mechanisms to evade defenses, such as those blocking processes spawning directly from Office documents, and analysis targeting unusual/potentially malicious parent-child process relationships, such as spoofing the PPID of [PowerShell](https://attack.mitre.org/techniques/T1059/001)/[Rundll32](https://attack.mitre.org/techniques/T1218/011) to be <code>explorer.exe</code> rather than an Office document delivered as part of [Spearphishing Attachment](https://attack.mitre.org/techniques/T1566/001).(Citation: CounterCept PPID Spoofing Dec 2018) This spoofing could be executed via [Visual Basic](https://attack.mitre.org/techniques/T1059/005) within a malicious Office document or any code that can perform [Native API](https://attack.mitre.org/techniques/T1106).(Citation: CTD PPID Spoofing Macro Mar 2019)(Citation: CounterCept PPID Spoofing Dec 2018)

Explicitly assigning the PPID may also enable elevated privileges given appropriate access rights to the parent process. For example, an adversary in a privileged user context (i.e. administrator) may spawn a new process and assign the parent as a process running as SYSTEM (such as <code>lsass.exe</code>), causing the new process to be elevated via the inherited access token.(Citation: XPNSec PPID Nov 2017)</blockquote>

## Policy / Process Controls
### [MITRE D3FEND](https://d3fend.mitre.org/)
**Last accessed:** April 27, 2022

**Total ATT&CK-mapped resources:** 2328

**ATT&CK-mapped resources for this (sub)technique:** 3

Resources mapped to this (sub)technique can be viewed on [this page](https://d3fend.mitre.org/) (see also the [ATT&CK to D3FEND Mapper](https://d3fend.mitre.org/tools/attack-mapper) tool):

* [System Call Filtering](https://d3fend.mitre.org/techniques/d3f:SystemCallFiltering)
* [Process Spawn Analysis](https://d3fend.mitre.org/techniques/d3f:ProcessSpawnAnalysis)
* [System Call Analysis](https://d3fend.mitre.org/techniques/d3f:SystemCallAnalysis)

## Technical Controls (Detection Rules)
### [Splunk Security Content](https://github.com/splunk/security_content)
**Last accessed:** May 19, 2022

**Total ATT&CK-mapped rules:** 1478

**ATT&CK-mapped resources for this (sub)technique:** 1

Resources mapped to this (sub)technique can be located in the following files within the repository's <code>[detections](https://github.com/splunk/security_content/tree/develop/detections)</code> folder:

* [endpoint](https://github.com/splunk/security_content/tree/develop/detections/endpoint/) / **[Wscript Or Cscript Suspicious Child Process](https://github.com/splunk/security_content/blob/develop/detections/endpoint/wscript_or_cscript_suspicious_child_process.yml)**


## Offensive Security Tests
### [Atomic Red Team](https://github.com/redcanaryco/atomic-red-team)
**Last accessed:** May 16, 2022

**Total ATT&CK-mapped tests:** 1258

**ATT&CK-mapped resources for this (sub)technique:** 10

The following unit tests mapped to this (sub)technique can be located in the file [here](https://github.com/redcanaryco/atomic-red-team/tree/master/atomics/T1134.004/T1134.004.yaml):

* Parent PID Spoofing using PowerShell
* Parent PID Spoofing - Spawn from Current Process
* Parent PID Spoofing - Spawn from Specified Process
* Parent PID Spoofing - Spawn from svchost.exe
* Parent PID Spoofing - Spawn from New Process
* Parent PID Spoofing using PowerShell
* Parent PID Spoofing - Spawn from Current Process
* Parent PID Spoofing - Spawn from Specified Process
* Parent PID Spoofing - Spawn from svchost.exe
* Parent PID Spoofing - Spawn from New Process

