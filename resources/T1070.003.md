# T1070.003: Clear Command History
**MITRE ATT&CK Tactic(s):** Defense Evasion

**[MITRE ATT&CK Description](https://attack.mitre.org/techniques/T1070/003)**
<blockquote>In addition to clearing system logs, an adversary may clear the command history of a compromised account to conceal the actions undertaken during an intrusion. Various command interpreters keep track of the commands users type in their terminal so that users can retrace what they've done.

On Linux and macOS, these command histories can be accessed in a few different ways. While logged in, this command history is tracked in a file pointed to by the environment variable <code>HISTFILE</code>. When a user logs off a system, this information is flushed to a file in the user's home directory called <code>~/.bash_history</code>. The benefit of this is that it allows users to go back to commands they've used before in different sessions.

Adversaries may delete their commands from these logs by manually clearing the history (<code>history -c</code>) or deleting the bash history file <code>rm ~/.bash_history</code>.

On Windows hosts, PowerShell has two different command history providers: the built-in history and the command history managed by the <code>PSReadLine</code> module. The built-in history only tracks the commands used in the current session. This command history is not available to other sessions and is deleted when the session ends.

The <code>PSReadLine</code> command history tracks the commands used in all PowerShell sessions and writes them to a file (<code>$env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt</code> by default). This history file is available to all sessions and contains all past history since the file is not deleted when the session ends.(Citation: Microsoft PowerShell Command History)

Adversaries may run the PowerShell command <code>Clear-History</code> to flush the entire command history from a current PowerShell session. This, however, will not delete/flush the <code>ConsoleHost_history.txt</code> file. Adversaries may also delete the <code>ConsoleHost_history.txt</code> file or edit its contents to hide PowerShell commands they have run.(Citation: Sophos PowerShell command audit)(Citation: Sophos PowerShell Command History Forensics)</blockquote>

## Policy / Process Controls
### [MITRE D3FEND](https://d3fend.mitre.org/)
**Last accessed:** May 23, 2022

**Total ATT&CK-mapped resources:** 2328

**ATT&CK-mapped resources for this (sub)technique:** 1

Resources mapped to this (sub)technique can be viewed on [this page](https://d3fend.mitre.org/) (see also the [ATT&CK to D3FEND Mapper](https://d3fend.mitre.org/tools/attack-mapper) tool):

* [no defensive relations yet](https://d3fend.mitre.org/technique/d3f:nodefensiverelationsyet)

## Technical Controls (Detection Rules)
### [Cyber Analytics Repository](https://car.mitre.org)
**Last accessed:** May 23, 2022

**Total ATT&CK-mapped rules:** 159

**ATT&CK-mapped resources for this (sub)technique:** 1

Resources mapped to this (sub)technique can be located in the following files within the repository's <code>[analytics](https://github.com/mitre-attack/car/blob/master/analytics)</code> folder:

* [Clear Powershell Console Command History](https://github.com/mitre-attack/car/tree/master/analytics/CAR-2020-11-005.yaml)

### [Elastic Detection Rules](https://github.com/elastic/detection-rules)
**Last accessed:** May 23, 2022

**Total ATT&CK-mapped rules:** 560

**ATT&CK-mapped resources for this (sub)technique:** 2

Resources mapped to this (sub)technique can be located in the following files within the repository's <code>[rules](https://github.com/elastic/detection-rules/tree/main/rules)</code> folder:

* [linux](https://github.com/elastic/detection-rules/tree/main/rules/linux/) / **[Tampering of Bash Command-Line History](https://github.com/elastic/detection-rules/blob/main/rules/linux/defense_evasion_deletion_of_bash_command_line_history.toml)**
* [windows](https://github.com/elastic/detection-rules/tree/main/rules/windows/) / **[Clearing Windows Console History](https://github.com/elastic/detection-rules/blob/main/rules/windows/defense_evasion_clearing_windows_console_history.toml)**

### [Sigma rules public repository](https://github.com/SigmaHQ/sigma)
**Last accessed:** May 23, 2022

**Total ATT&CK-mapped rules:** 2360

**ATT&CK-mapped resources for this (sub)technique:** 6

Resources mapped to this (sub)technique can be located in the following files within the repository's <code>[rules](https://github.com/SigmaHQ/sigma/tree/master/rules)</code> folder:

* [linux](https://github.com/SigmaHQ/sigma/tree/master/rules/linux/) / [builtin](https://github.com/SigmaHQ/sigma/tree/master/rules/linux/builtin/) / **[Clear Command History](https://github.com/SigmaHQ/sigma/blob/master/rules/linux/builtin/lnx_shell_clear_cmd_history.yml)**
* [network](https://github.com/SigmaHQ/sigma/tree/master/rules/network/) / [cisco](https://github.com/SigmaHQ/sigma/tree/master/rules/network/cisco/) / [aaa](https://github.com/SigmaHQ/sigma/tree/master/rules/network/cisco/aaa/) / **[Cisco Clear Logs](https://github.com/SigmaHQ/sigma/blob/master/rules/network/cisco/aaa/cisco_cli_clear_logs.yml)**
* [windows](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/) / [powershell](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/powershell/) / [powershell_module](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/powershell/powershell_module/) / **[Clear PowerShell History](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/powershell/powershell_module/posh_pm_clear_powershell_history.yml)**
* [windows](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/) / [powershell](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/powershell/) / [powershell_script](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/powershell/powershell_script/) / **[Clearing Windows Console History](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/powershell/powershell_script/posh_ps_clearing_windows_console_history.yml)**
* [windows](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/) / [powershell](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/powershell/) / [powershell_script](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/powershell/powershell_script/) / **[Clear PowerShell History](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/powershell/powershell_script/posh_ps_clear_powershell_history.yml)**
* [windows](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/) / [powershell](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/powershell/) / [powershell_script](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/powershell/powershell_script/) / **[Suspicious IO.FileStream](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/powershell/powershell_script/posh_ps_susp_iofilestream.yml)**


## Offensive Security Tests
### [Atomic Red Team](https://github.com/redcanaryco/atomic-red-team)
**Last accessed:** May 23, 2022

**Total ATT&CK-mapped tests:** 1262

**ATT&CK-mapped resources for this (sub)technique:** 11

The following unit tests mapped to this (sub)technique can be located in [the file here](https://github.com/redcanaryco/atomic-red-team/tree/master/atomics/T1070.003/T1070.003.yaml):

* Clear Bash history (rm)
* Clear Bash history (echo)
* Clear Bash history (cat dev/null)
* Clear Bash history (ln dev/null)
* Clear Bash history (truncate)
* Clear history of a bunch of shells
* Clear and Disable Bash History Logging
* Use Space Before Command to Avoid Logging to History
* Disable Bash History Logging with SSH -T
* Prevent Powershell History Logging
* Clear Powershell History by Deleting History File

