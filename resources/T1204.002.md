# T1204.002: Malicious File
**MITRE ATT&CK Tactic(s):** Execution

**[MITRE ATT&CK Description](https://attack.mitre.org/techniques/T1204/002)**
<blockquote>An adversary may rely upon a user opening a malicious file in order to gain execution. Users may be subjected to social engineering to get them to open a file that will lead to code execution. This user action will typically be observed as follow-on behavior from [Spearphishing Attachment](https://attack.mitre.org/techniques/T1566/001). Adversaries may use several types of files that require a user to execute them, including .doc, .pdf, .xls, .rtf, .scr, .exe, .lnk, .pif, and .cpl.

Adversaries may employ various forms of [Masquerading](https://attack.mitre.org/techniques/T1036) on the file to increase the likelihood that a user will open it.

While [Malicious File](https://attack.mitre.org/techniques/T1204/002) frequently occurs shortly after Initial Access it may occur at other phases of an intrusion, such as when an adversary places a file in a shared directory or on a user's desktop hoping that a user will click on it. This activity may also be seen shortly after [Internal Spearphishing](https://attack.mitre.org/techniques/T1534).</blockquote>
## Policy / Process Controls
### [MITRE D3FEND](https://d3fend.mitre.org/)
**Last accessed:** April 25, 2022

**Total ATT&CK-mapped resources:** 2328

**ATT&CK-mapped resources for this (sub)technique:**7

Resources mapped to this (sub)technique can be viewed on [this page](https://d3fend.mitre.org/) (see also the [ATT&CK to D3FEND Mapper](https://d3fend.mitre.org/tools/attack-mapper) tool):

* [File Analysis](https://d3fend.mitre.org/techniques/d3f:FileAnalysis)
* [Dynamic Analysis](https://d3fend.mitre.org/techniques/d3f:DynamicAnalysis)
* [Emulated File Analysis](https://d3fend.mitre.org/techniques/d3f:EmulatedFileAnalysis)
* [Local File Permissions](https://d3fend.mitre.org/techniques/d3f:LocalFilePermissions)
* [Executable Allowlisting](https://d3fend.mitre.org/techniques/d3f:ExecutableAllowlisting)
* [Executable Denylisting](https://d3fend.mitre.org/techniques/d3f:ExecutableDenylisting)
* [Decoy File](https://d3fend.mitre.org/techniques/d3f:DecoyFile)

## Technical Controls (Detection Rules)
### [Cyber Analytics Repository](https://car.mitre.org)
**Last accessed:** April 25, 2022

**Total ATT&CK-mapped rules:** 159

**ATT&CK-mapped resources for this (sub)technique:**1

Resources mapped to this (sub)technique can be located in the following files within [this repository](https://github.com/mitre-attack/car/blob/master/analytics):

* [car/analytics/CAR-2021-05-002.yaml](https://github.com/mitre-attack/car/blob/master/analytics/CAR-2021-05-002.yaml)

### [Sigma rules public repository](https://github.com/SigmaHQ/sigma)
**Last accessed:** April 25, 2022

**Total ATT&CK-mapped rules:** 2330

**ATT&CK-mapped resources for this (sub)technique:**27

Resources mapped to this (sub)technique can be located in the following files within [this repository](https://github.com/SigmaHQ/sigma/tree/master/rules):

* [sigma/rules/proxy/proxy_download_susp_tlds_blacklist.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/proxy/proxy_download_susp_tlds_blacklist.yml)
* [sigma/rules/proxy/proxy_download_susp_tlds_whitelist.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/proxy/proxy_download_susp_tlds_whitelist.yml)
* [sigma/rules/proxy/proxy_susp_flash_download_loc.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/proxy/proxy_susp_flash_download_loc.yml)
* [sigma/rules/proxy/proxy_ursnif_malware_c2_url.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/proxy/proxy_ursnif_malware_c2_url.yml)
* [sigma/rules/windows/builtin/applocker/win_applocker_file_was_not_allowed_to_run.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/applocker/win_applocker_file_was_not_allowed_to_run.yml)
* [sigma/rules/windows/file_event/file_event_win_script_creation_by_office_using_file_ext.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/file_event/file_event_win_script_creation_by_office_using_file_ext.yml)
* [sigma/rules/windows/image_load/image_load_susp_office_dotnet_assembly_dll_load.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/image_load/image_load_susp_office_dotnet_assembly_dll_load.yml)
* [sigma/rules/windows/image_load/image_load_susp_office_dotnet_clr_dll_load.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/image_load/image_load_susp_office_dotnet_clr_dll_load.yml)
* [sigma/rules/windows/image_load/image_load_susp_office_dotnet_gac_dll_load.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/image_load/image_load_susp_office_dotnet_gac_dll_load.yml)
* [sigma/rules/windows/image_load/image_load_susp_office_dsparse_dll_load.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/image_load/image_load_susp_office_dsparse_dll_load.yml)
* [sigma/rules/windows/image_load/image_load_susp_office_kerberos_dll_load.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/image_load/image_load_susp_office_kerberos_dll_load.yml)
* [sigma/rules/windows/image_load/image_load_susp_winword_vbadll_load.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/image_load/image_load_susp_winword_vbadll_load.yml)
* [sigma/rules/windows/process_access/proc_access_win_littlecorporal_generated_maldoc.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_access/proc_access_win_littlecorporal_generated_maldoc.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_crime_maze_ransomware.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_crime_maze_ransomware.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_exploit_cve_2017_0261.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_exploit_cve_2017_0261.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_exploit_cve_2017_11882.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_exploit_cve_2017_11882.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_exploit_cve_2017_8759.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_exploit_cve_2017_8759.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_lolbins_by_office_applications.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_lolbins_by_office_applications.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_lolbins_with_wmiprvse_parent_process.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_lolbins_with_wmiprvse_parent_process.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_office_applications_spawning_wmi_commandline.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_office_applications_spawning_wmi_commandline.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_office_from_proxy_executing_regsvr32_payload.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_office_from_proxy_executing_regsvr32_payload.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_office_from_proxy_executing_regsvr32_payload2.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_office_from_proxy_executing_regsvr32_payload2.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_office_shell.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_office_shell.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_office_spawning_wmi_commandline.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_office_spawning_wmi_commandline.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_office_spawn_exe_from_users_directory.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_office_spawn_exe_from_users_directory.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_outlook_shell.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_outlook_shell.yml)
* [sigma/rules/windows/registry/registry_set/registry_set_new_application_appcompat.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/registry/registry_set/registry_set_new_application_appcompat.yml)

### [Splunk Security Content](https://github.com/splunk/security_content)
**Last accessed:** April 25, 2022

**Total ATT&CK-mapped rules:** 1393

**ATT&CK-mapped resources for this (sub)technique:**4

Resources mapped to this (sub)technique can be located in the following files within [this repository](https://github.com/splunk/security_content/tree/develop/detections):

* [security_content/detections/deprecated/uncommon_processes_on_endpoint.yml](https://github.com/splunk/security_content/blob/develop/detections/deprecated/uncommon_processes_on_endpoint.yml)
* [security_content/detections/endpoint/batch_file_write_to_system32.yml](https://github.com/splunk/security_content/blob/develop/detections/endpoint/batch_file_write_to_system32.yml)
* [security_content/detections/endpoint/drop_icedid_license_dat.yml](https://github.com/splunk/security_content/blob/develop/detections/endpoint/drop_icedid_license_dat.yml)
* [security_content/detections/endpoint/single_letter_process_on_endpoint.yml](https://github.com/splunk/security_content/blob/develop/detections/endpoint/single_letter_process_on_endpoint.yml)


## Offensive Security Tests
### [Atomic Red Team](https://github.com/redcanaryco/atomic-red-team)
**Last accessed:** April 25, 2022

**Total ATT&CK-mapped tests:** 1161

**ATT&CK-mapped resources for this (sub)technique:**9

The following unit tests mapped to this (sub)technique can be located in the file [here](https://github.com/redcanaryco/atomic-red-team/tree/master/atomics/T1204.002/T1204.002.yaml):

* OSTap Style Macro Execution
* OSTap Payload Download
* Maldoc choice flags command execution
* OSTAP JS version
* Office launching .bat file from AppData
* Excel 4 Macro
* Headless Chrome code execution via VBA
* Potentially Unwanted Applications (PUA)
* Office Generic Payload Download

### [Cyber Analytics Repository](https://car.mitre.org)
**Last accessed:** April 25, 2022

**Total ATT&CK-mapped tests:** 70

**ATT&CK-mapped resources for this (sub)technique:**1

Resources mapped to this (sub)technique can be located in the following files within [this repository](https://github.com/mitre-attack/car/blob/master/analytics):

* [car/analytics/CAR-2021-05-002.yaml](https://github.com/mitre-attack/car/blob/master/analytics/CAR-2021-05-002.yaml): 2 <code>unit_tests</code>

