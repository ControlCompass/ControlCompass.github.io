# T1187: Forced Authentication
**MITRE ATT&CK Tactic(s):** Credential Access

**[MITRE ATT&CK Description](https://attack.mitre.org/techniques/T1187)**
<blockquote>Adversaries may gather credential material by invoking or forcing a user to automatically provide authentication information through a mechanism in which they can intercept.

The Server Message Block (SMB) protocol is commonly used in Windows networks for authentication and communication between systems for access to resources and file sharing. When a Windows system attempts to connect to an SMB resource it will automatically attempt to authenticate and send credential information for the current user to the remote system. (Citation: Wikipedia Server Message Block) This behavior is typical in enterprise environments so that users do not need to enter credentials to access network resources.

Web Distributed Authoring and Versioning (WebDAV) is also typically used by Windows systems as a backup protocol when SMB is blocked or fails. WebDAV is an extension of HTTP and will typically operate over TCP ports 80 and 443. (Citation: Didier Stevens WebDAV Traffic) (Citation: Microsoft Managing WebDAV Security)

Adversaries may take advantage of this behavior to gain access to user account hashes through forced SMB/WebDAV authentication. An adversary can send an attachment to a user through spearphishing that contains a resource link to an external server controlled by the adversary (i.e. [Template Injection](https://attack.mitre.org/techniques/T1221)), or place a specially crafted file on navigation path for privileged accounts (e.g. .SCF file placed on desktop) or on a publicly accessible share to be accessed by victim(s). When the user's system accesses the untrusted resource it will attempt authentication and send information, including the user's hashed credentials, over SMB to the adversary controlled server. (Citation: GitHub Hashjacking) With access to the credential hash, an adversary can perform off-line [Brute Force](https://attack.mitre.org/techniques/T1110) cracking to gain access to plaintext credentials. (Citation: Cylance Redirect to SMB)

There are several different ways this can occur. (Citation: Osanda Stealing NetNTLM Hashes) Some specifics from in-the-wild use include:

* A spearphishing attachment containing a document with a resource that is automatically loaded when the document is opened (i.e. [Template Injection](https://attack.mitre.org/techniques/T1221)). The document can include, for example, a request similar to <code>file[:]//[remote address]/Normal.dotm</code> to trigger the SMB request. (Citation: US-CERT APT Energy Oct 2017)
* A modified .LNK or .SCF file with the icon filename pointing to an external reference such as <code>\\[remote address]\pic.png</code> that will force the system to load the resource when the icon is rendered to repeatedly gather credentials. (Citation: US-CERT APT Energy Oct 2017)</blockquote>

## Policy / Process Controls
### [MITRE D3FEND](https://d3fend.mitre.org/)
**Last accessed:** April 27, 2022

**Total ATT&CK-mapped resources:** 2328

**ATT&CK-mapped resources for this (sub)technique:** 6

Resources mapped to this (sub)technique can be viewed on [this page](https://d3fend.mitre.org/) (see also the [ATT&CK to D3FEND Mapper](https://d3fend.mitre.org/tools/attack-mapper) tool):

* [Local File Permissions](https://d3fend.mitre.org/techniques/d3f:LocalFilePermissions)
* [Decoy File](https://d3fend.mitre.org/techniques/d3f:DecoyFile)
* [File Analysis](https://d3fend.mitre.org/techniques/d3f:FileAnalysis)
* [Authentication Event Thresholding](https://d3fend.mitre.org/techniques/d3f:AuthenticationEventThresholding)
* [Resource Access Pattern Analysis](https://d3fend.mitre.org/techniques/d3f:ResourceAccessPatternAnalysis)
* [Session Duration Analysis](https://d3fend.mitre.org/techniques/d3f:SessionDurationAnalysis)

## Technical Controls (Detection Rules)
### [Cyber Analytics Repository](https://car.mitre.org)
**Last accessed:** May 19, 2022

**Total ATT&CK-mapped rules:** 159

**ATT&CK-mapped resources for this (sub)technique:** 1

Resources mapped to this (sub)technique can be located in the following files within the repository's <code>[analytics](https://github.com/mitre-attack/car/blob/master/analytics)</code> folder:

* [SMB Session Setups](https://github.com/mitre-attack/car/tree/master/analytics/CAR-2013-09-003.yaml)

### [Sigma rules public repository](https://github.com/SigmaHQ/sigma)
**Last accessed:** May 19, 2022

**Total ATT&CK-mapped rules:** 2356

**ATT&CK-mapped resources for this (sub)technique:** 3

Resources mapped to this (sub)technique can be located in the following files within the repository's <code>[rules](https://github.com/SigmaHQ/sigma/tree/master/rules)</code> folder:

* [network](https://github.com/SigmaHQ/sigma/tree/master/rules/network/) / [zeek](https://github.com/SigmaHQ/sigma/tree/master/rules/network/zeek/) / **[Potential PetitPotam Attack Via EFS RPC Calls](https://github.com/SigmaHQ/sigma/blob/master/rules/network/zeek/zeek_dce_rpc_potential_petit_potam_efs_rpc_call.yml)**
* [windows](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/) / [builtin](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/builtin/) / [security](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/builtin/security/) / **[Possible PetitPotam Coerce Authentication Attempt](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/security/win_petitpotam_network_share.yml)**
* [windows](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/) / [builtin](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/builtin/) / [security](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/builtin/security/) / **[PetitPotam Suspicious Kerberos TGT Request](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/security/win_petitpotam_susp_tgt_request.yml)**

### [Splunk Security Content](https://github.com/splunk/security_content)
**Last accessed:** May 19, 2022

**Total ATT&CK-mapped rules:** 1478

**ATT&CK-mapped resources for this (sub)technique:** 1

Resources mapped to this (sub)technique can be located in the following files within the repository's <code>[detections](https://github.com/splunk/security_content/tree/develop/detections)</code> folder:

* [endpoint](https://github.com/splunk/security_content/tree/develop/detections/endpoint/) / **[PetitPotam Network Share Access Request](https://github.com/splunk/security_content/blob/develop/detections/endpoint/petitpotam_network_share_access_request.yml)**


## Offensive Security Tests
### [Atomic Red Team](https://github.com/redcanaryco/atomic-red-team)
**Last accessed:** May 16, 2022

**Total ATT&CK-mapped tests:** 1258

**ATT&CK-mapped resources for this (sub)technique:** 2

The following unit tests mapped to this (sub)technique can be located in the file [here](https://github.com/redcanaryco/atomic-red-team/tree/master/atomics/T1187/T1187.yaml):

* PetitPotam
* WinPwn - PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS

