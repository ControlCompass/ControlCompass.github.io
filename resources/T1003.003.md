# T1003.003: NTDS
**MITRE ATT&CK Tactic(s):** Credential Access

**[MITRE ATT&CK Description](https://attack.mitre.org/techniques/T1003/003)**
<blockquote>Adversaries may attempt to access or create a copy of the Active Directory domain database in order to steal credential information, as well as obtain other information about domain members such as devices, users, and access rights. By default, the NTDS file (NTDS.dit) is located in <code>%SystemRoot%\NTDS\Ntds.dit</code> of a domain controller.(Citation: Wikipedia Active Directory)

In addition to looking for NTDS files on active Domain Controllers, attackers may search for backups that contain the same or similar information.(Citation: Metcalf 2015)

The following tools and techniques can be used to enumerate the NTDS file and the contents of the entire Active Directory hashes.

* Volume Shadow Copy
* secretsdump.py
* Using the in-built Windows tool, ntdsutil.exe
* Invoke-NinjaCopy
</blockquote>
## Policy / Process Controls
### [MITRE D3FEND](https://d3fend.mitre.org/)
**Last accessed:** April 25, 2022

**Total ATT&CK-mapped resources:** 2328

**ATT&CK-mapped resources for this (sub)technique:**4

Resources mapped to this (sub)technique can be viewed on [this page](https://d3fend.mitre.org/) (see also the [ATT&CK to D3FEND Mapper](https://d3fend.mitre.org/tools/attack-mapper) tool):

* [Decoy User Credential](https://d3fend.mitre.org/techniques/d3f:DecoyUserCredential)
* [Credential Compromise Scope Analysis](https://d3fend.mitre.org/techniques/d3f:CredentialCompromiseScopeAnalysis)
* [Authentication Cache Invalidation](https://d3fend.mitre.org/techniques/d3f:AuthenticationCacheInvalidation)
* [Credential Transmission Scoping](https://d3fend.mitre.org/techniques/d3f:CredentialTransmissionScoping)

## Technical Controls (Detection Rules)
### [Cyber Analytics Repository](https://car.mitre.org)
**Last accessed:** April 25, 2022

**Total ATT&CK-mapped rules:** 159

**ATT&CK-mapped resources for this (sub)technique:**2

Resources mapped to this (sub)technique can be located in the following files within [this repository](https://github.com/mitre-attack/car/blob/master/analytics):

* [car/analytics/CAR-2019-08-002.yaml](https://github.com/mitre-attack/car/blob/master/analytics/CAR-2019-08-002.yaml)
* [car/analytics/CAR-2020-05-001.yaml](https://github.com/mitre-attack/car/blob/master/analytics/CAR-2020-05-001.yaml)

### [Sigma rules public repository](https://github.com/SigmaHQ/sigma)
**Last accessed:** April 25, 2022

**Total ATT&CK-mapped rules:** 2330

**ATT&CK-mapped resources for this (sub)technique:**18

Resources mapped to this (sub)technique can be located in the following files within [this repository](https://github.com/SigmaHQ/sigma/tree/master/rules):

* [sigma/rules/network/zeek/zeek_smb_converted_win_impacket_secretdump.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/network/zeek/zeek_smb_converted_win_impacket_secretdump.yml)
* [sigma/rules/network/zeek/zeek_smb_converted_win_transferring_files_with_credential_data.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/network/zeek/zeek_smb_converted_win_transferring_files_with_credential_data.yml)
* [sigma/rules/windows/builtin/security/win_impacket_secretdump.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/security/win_impacket_secretdump.yml)
* [sigma/rules/windows/builtin/security/win_transferring_files_with_credential_data_via_network_shares.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/security/win_transferring_files_with_credential_data_via_network_shares.yml)
* [sigma/rules/windows/file_event/file_event_win_cred_dump_tools_dropped_files.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/file_event/file_event_win_cred_dump_tools_dropped_files.yml)
* [sigma/rules/windows/file_event/file_event_win_ntds_dit.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/file_event/file_event_win_ntds_dit.yml)
* [sigma/rules/windows/file_event/file_event_win_ntds_exfil_tools.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/file_event/file_event_win_ntds_exfil_tools.yml)
* [sigma/rules/windows/file_event/file_event_win_susp_ntds_dit.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/file_event/file_event_win_susp_ntds_dit.yml)
* [sigma/rules/windows/powershell/powershell_module/posh_pm_get_addbaccount.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/powershell/powershell_module/posh_pm_get_addbaccount.yml)
* [sigma/rules/windows/powershell/powershell_script/posh_ps_create_volume_shadow_copy.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/powershell/powershell_script/posh_ps_create_volume_shadow_copy.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_apt_bear_activity_gtr19.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_apt_bear_activity_gtr19.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_copying_sensitive_files_with_credential_data.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_copying_sensitive_files_with_credential_data.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_shadow_copies_access_symlink.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_shadow_copies_access_symlink.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_shadow_copies_creation.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_shadow_copies_creation.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_susp_ditsnap.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_ditsnap.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_susp_esentutl_params.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_esentutl_params.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_susp_ntds.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_ntds.yml)
* [sigma/rules/windows/process_creation/proc_creation_win_susp_ntdsutil.yml](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_ntdsutil.yml)

### [Splunk Security Content](https://github.com/splunk/security_content)
**Last accessed:** April 25, 2022

**Total ATT&CK-mapped rules:** 1393

**ATT&CK-mapped resources for this (sub)technique:**7

Resources mapped to this (sub)technique can be located in the following files within [this repository](https://github.com/splunk/security_content/tree/develop/detections):

* [security_content/detections/endpoint/ssa___detect_dump_lsass_memory_using_comsvcs.yml](https://github.com/splunk/security_content/blob/develop/detections/endpoint/ssa___detect_dump_lsass_memory_using_comsvcs.yml)
* [security_content/detections/endpoint/creation_of_shadow_copy.yml](https://github.com/splunk/security_content/blob/develop/detections/endpoint/creation_of_shadow_copy.yml)
* [security_content/detections/endpoint/credential_dumping_via_copy_command_from_shadow_copy.yml](https://github.com/splunk/security_content/blob/develop/detections/endpoint/credential_dumping_via_copy_command_from_shadow_copy.yml)
* [security_content/detections/endpoint/secretdumps_offline_ntds_dumping_tool.yml](https://github.com/splunk/security_content/blob/develop/detections/endpoint/secretdumps_offline_ntds_dumping_tool.yml)
* [security_content/detections/endpoint/credential_dumping_via_symlink_to_shadow_copy.yml](https://github.com/splunk/security_content/blob/develop/detections/endpoint/credential_dumping_via_symlink_to_shadow_copy.yml)
* [security_content/detections/endpoint/ntdsutil_export_ntds.yml](https://github.com/splunk/security_content/blob/develop/detections/endpoint/ntdsutil_export_ntds.yml)
* [security_content/detections/endpoint/creation_of_shadow_copy_with_wmic_and_powershell.yml](https://github.com/splunk/security_content/blob/develop/detections/endpoint/creation_of_shadow_copy_with_wmic_and_powershell.yml)


## Offensive Security Tests
### [Atomic Red Team](https://github.com/redcanaryco/atomic-red-team)
**Last accessed:** April 25, 2022

**Total ATT&CK-mapped tests:** 1161

**ATT&CK-mapped resources for this (sub)technique:**8

The following unit tests mapped to this (sub)technique can be located in the file [here](https://github.com/redcanaryco/atomic-red-team/tree/master/atomics/T1003.003/T1003.003.yaml):

* Create Volume Shadow Copy with vssadmin
* Copy NTDS.dit from Volume Shadow Copy
* Dump Active Directory Database with NTDSUtil
* Create Volume Shadow Copy with WMI
* Create Volume Shadow Copy remotely with WMI
* Create Volume Shadow Copy remotely (WMI) with esentutl
* Create Volume Shadow Copy with Powershell
* Create Symlink to Volume Shadow Copy

### [Cyber Analytics Repository](https://car.mitre.org)
**Last accessed:** April 25, 2022

**Total ATT&CK-mapped tests:** 70

**ATT&CK-mapped resources for this (sub)technique:**1

Resources mapped to this (sub)technique can be located in the following files within [this repository](https://github.com/mitre-attack/car/blob/master/analytics):

* [car/analytics/CAR-2019-08-002.yaml](https://github.com/mitre-attack/car/blob/master/analytics/CAR-2019-08-002.yaml): 1 <code>unit_tests</code>

